USE [alliant_mvc]
GO

/****** Object:  StoredProcedure [dbo].[spr_tb_VW_InActiveAccountFolloUpData_View_Search]    Script Date: 11-08-2020 22:52:32 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

ALTER PROCEDURE [dbo].[spr_tb_VW_InActiveAccountFolloUpData_View_Search]@ResultCount INT OUTPUT,@BranchID_Values nvarchar(max) = NULL,@BranchID_Min int = NULL,@BranchID_Max int = NULL,@Active nvarchar(3) = NULL,@Active_Values nvarchar(max) = NULL,@CustName nvarchar(255) = NULL,@CustName_Values nvarchar(max) = NULL,@RepId_Values nvarchar(max) = NULL,@RepId_Min int = NULL,@RepId_Max int = NULL,@SalesRep nvarchar(50) = NULL,@SalesRep_Values nvarchar(max) = NULL,@OrderFrequency nvarchar(50) = NULL,@OrderFrequency_Values nvarchar(max) = NULL,@DoNotContact bit = NULL,@DoNotContactDate_Values nvarchar(max) = NULL,@DoNotContactDate_Min datetime = NULL,@DoNotContactDate_Max datetime = NULL,@DoNotContactBy nvarchar(100) = NULL,@DoNotContactBy_Values nvarchar(max) = NULL,@CustomerId_Values nvarchar(max) = NULL,@CustomerId_Min int = NULL,@CustomerId_Max int = NULL,@EnterDate_Values nvarchar(max) = NULL,@EnterDate_Min datetime = NULL,@EnterDate_Max datetime = NULL,@QuoteId_Values nvarchar(max) = NULL,@QuoteId_Min int = NULL,@QuoteId_Max int = NULL,@DeliveryDate_Values nvarchar(max) = NULL,@DeliveryDate_Min datetime = NULL,@DeliveryDate_Max datetime = NULL,@Interest nvarchar(50) = NULL,@Interest_Values nvarchar(max) = NULL,@CustBranchCode nvarchar(50) = NULL,@CustBranchCode_Values nvarchar(max) = NULL,@QuoteBranchCode_Values nvarchar(max) = NULL,@QuoteBranchCode_Min int = NULL,@QuoteBranchCode_Max int = NULL,@Note_Values nvarchar(max) = NULL,@Note_Min int = NULL,@Note_Max int = NULL,@MaxDateTime_Values nvarchar(max) = NULL,@MaxDateTime_Min datetime = NULL,@MaxDateTime_Max datetime = NULL,@Total_Values nvarchar(max) = NULL,@Total_Min money = NULL,@Total_Max money = NULL,@LastActivityNote nvarchar(150) = NULL,@LastActivityNote_Values nvarchar(max) = NULL,@LastActivityDateTime_Values nvarchar(max) = NULL,@LastActivityDateTime_Min datetime = NULL,@LastActivityDateTime_Max datetime = NULL,@Page_Size int  = NULL,@Page_Index int = NULL,@Sort_Column nvarchar(250) = NULL,@Sort_Ascending bit  = NULL,@IsBinaryRequired bit = 0,@IsPrimaryIN bit = 1ASBEGINSET NOCOUNT ON;SET @ResultCount = 0IF NOT (@Page_Size IS NULL OR @Page_Index IS NULL)BEGINSET @ResultCount = (SELECT COUNT(1) FROM [dbo].[VW_InActiveAccountFolloUpData] (NOLOCK) WHERE (@BranchID_Values IS NULL OR  (@BranchID_Values = '###NULL###' AND [BranchID] IS NULL ) OR (@BranchID_Values <> '###NULL###' AND [BranchID] IN(SELECT [Item] FROM [dbo].CustomeSplit(@BranchID_Values,',')))) AND (@BranchID_Min IS NULL OR [BranchID] >=  @BranchID_Min) AND (@BranchID_Max IS NULL OR [BranchID] <=  @BranchID_Max) AND (@Active IS NULL OR (@Active = '###NULL###' AND Active IS NULL ) OR (@Active <> '###NULL###' AND [Active] LIKE '%'+@Active+'%')) AND (@Active_Values IS NULL OR (@Active_Values = '###NULL###' AND [Active] IS NULL ) OR (@Active_Values <> '###NULL###' AND [Active] IN(SELECT [Item] FROM [dbo].CustomeSplit(@Active_Values,',')))) AND (@CustName IS NULL OR (@CustName = '###NULL###' AND CustName IS NULL ) OR (@CustName <> '###NULL###' AND [CustName] LIKE '%'+@CustName+'%')) AND (@CustName_Values IS NULL OR (@CustName_Values = '###NULL###' AND [CustName] IS NULL ) OR (@CustName_Values <> '###NULL###' AND [CustName] IN(SELECT [Item] FROM [dbo].CustomeSplit(@CustName_Values,',')))) AND (@RepId_Values IS NULL OR  (@RepId_Values = '###NULL###' AND [RepId] IS NULL ) OR (@RepId_Values <> '###NULL###' AND [RepId] IN(SELECT [Item] FROM [dbo].CustomeSplit(@RepId_Values,',')))) AND (@RepId_Min IS NULL OR [RepId] >=  @RepId_Min) AND (@RepId_Max IS NULL OR [RepId] <=  @RepId_Max) AND (@SalesRep IS NULL OR (@SalesRep = '###NULL###' AND SalesRep IS NULL ) OR (@SalesRep <> '###NULL###' AND [SalesRep] LIKE '%'+@SalesRep+'%')) AND (@SalesRep_Values IS NULL OR (@SalesRep_Values = '###NULL###' AND [SalesRep] IS NULL ) OR (@SalesRep_Values <> '###NULL###' AND [SalesRep] IN(SELECT [Item] FROM [dbo].CustomeSplit(@SalesRep_Values,',')))) AND (@OrderFrequency IS NULL OR (@OrderFrequency = '###NULL###' AND OrderFrequency IS NULL ) OR (@OrderFrequency <> '###NULL###' AND [OrderFrequency] LIKE '%'+@OrderFrequency+'%')) AND (@OrderFrequency_Values IS NULL OR (@OrderFrequency_Values = '###NULL###' AND [OrderFrequency] IS NULL ) OR (@OrderFrequency_Values <> '###NULL###' AND [OrderFrequency] IN(SELECT [Item] FROM [dbo].CustomeSplit(@OrderFrequency_Values,',')))) AND (@DoNotContact IS NULL OR [DoNotContact] =  @DoNotContact) AND (@DoNotContactDate_Values IS NULL OR  (@DoNotContactDate_Values = '###NULL###' AND [DoNotContactDate] IS NULL ) OR (@DoNotContactDate_Values <> '###NULL###' AND [DoNotContactDate] IN(SELECT [Item] FROM [dbo].CustomeSplit(@DoNotContactDate_Values,',')))) AND (@DoNotContactDate_Min IS NULL OR [DoNotContactDate] >=  @DoNotContactDate_Min) AND (@DoNotContactDate_Max IS NULL OR [DoNotContactDate] <=  @DoNotContactDate_Max) AND (@DoNotContactBy IS NULL OR (@DoNotContactBy = '###NULL###' AND DoNotContactBy IS NULL ) OR (@DoNotContactBy <> '###NULL###' AND [DoNotContactBy] LIKE '%'+@DoNotContactBy+'%')) AND (@DoNotContactBy_Values IS NULL OR (@DoNotContactBy_Values = '###NULL###' AND [DoNotContactBy] IS NULL ) OR (@DoNotContactBy_Values <> '###NULL###' AND [DoNotContactBy] IN(SELECT [Item] FROM [dbo].CustomeSplit(@DoNotContactBy_Values,',')))) AND (@CustomerId_Values IS NULL OR  (@CustomerId_Values = '###NULL###' AND [CustomerId] IS NULL ) OR (@CustomerId_Values <> '###NULL###' AND [CustomerId] IN(SELECT [Item] FROM [dbo].CustomeSplit(@CustomerId_Values,',')))) AND (@CustomerId_Min IS NULL OR [CustomerId] >=  @CustomerId_Min) AND (@CustomerId_Max IS NULL OR [CustomerId] <=  @CustomerId_Max) AND (@EnterDate_Values IS NULL OR  (@EnterDate_Values = '###NULL###' AND [EnterDate] IS NULL ) OR (@EnterDate_Values <> '###NULL###' AND [EnterDate] IN(SELECT [Item] FROM [dbo].CustomeSplit(@EnterDate_Values,',')))) AND (@EnterDate_Min IS NULL OR [EnterDate] >=  @EnterDate_Min) AND (@EnterDate_Max IS NULL OR [EnterDate] <=  @EnterDate_Max) AND (@QuoteId_Values IS NULL OR  (@QuoteId_Values = '###NULL###' AND [QuoteId] IS NULL ) OR (@QuoteId_Values <> '###NULL###' AND [QuoteId] IN(SELECT [Item] FROM [dbo].CustomeSplit(@QuoteId_Values,',')))) AND (@QuoteId_Min IS NULL OR [QuoteId] >=  @QuoteId_Min) AND (@QuoteId_Max IS NULL OR [QuoteId] <=  @QuoteId_Max) AND (@DeliveryDate_Values IS NULL OR  (@DeliveryDate_Values = '###NULL###' AND [DeliveryDate] IS NULL ) OR (@DeliveryDate_Values <> '###NULL###' AND [DeliveryDate] IN(SELECT [Item] FROM [dbo].CustomeSplit(@DeliveryDate_Values,',')))) AND (@DeliveryDate_Min IS NULL OR [DeliveryDate] >=  @DeliveryDate_Min) AND (@DeliveryDate_Max IS NULL OR [DeliveryDate] <=  @DeliveryDate_Max) AND (@Interest IS NULL OR (@Interest = '###NULL###' AND Interest IS NULL ) OR (@Interest <> '###NULL###' AND [Interest] LIKE '%'+@Interest+'%')) AND (@Interest_Values IS NULL OR (@Interest_Values = '###NULL###' AND [Interest] IS NULL ) OR (@Interest_Values <> '###NULL###' AND [Interest] IN(SELECT [Item] FROM [dbo].CustomeSplit(@Interest_Values,',')))) AND (@CustBranchCode IS NULL OR (@CustBranchCode = '###NULL###' AND CustBranchCode IS NULL ) OR (@CustBranchCode <> '###NULL###' AND [CustBranchCode] LIKE '%'+@CustBranchCode+'%')) AND (@CustBranchCode_Values IS NULL OR (@CustBranchCode_Values = '###NULL###' AND [CustBranchCode] IS NULL ) OR (@CustBranchCode_Values <> '###NULL###' AND [CustBranchCode] IN(SELECT [Item] FROM [dbo].CustomeSplit(@CustBranchCode_Values,',')))) AND (@QuoteBranchCode_Values IS NULL OR  (@QuoteBranchCode_Values = '###NULL###' AND [QuoteBranchCode] IS NULL ) OR (@QuoteBranchCode_Values <> '###NULL###' AND [QuoteBranchCode] IN(SELECT [Item] FROM [dbo].CustomeSplit(@QuoteBranchCode_Values,',')))) AND (@QuoteBranchCode_Min IS NULL OR [QuoteBranchCode] >=  @QuoteBranchCode_Min) AND (@QuoteBranchCode_Max IS NULL OR [QuoteBranchCode] <=  @QuoteBranchCode_Max) AND (@Note_Values IS NULL OR  (@Note_Values = '###NULL###' AND [Note] IS NULL ) OR (@Note_Values <> '###NULL###' AND [Note] IN(SELECT [Item] FROM [dbo].CustomeSplit(@Note_Values,',')))) AND (@Note_Min IS NULL OR [Note] >=  @Note_Min) AND (@Note_Max IS NULL OR [Note] <=  @Note_Max) AND (@MaxDateTime_Values IS NULL OR  (@MaxDateTime_Values = '###NULL###' AND [MaxDateTime] IS NULL ) OR (@MaxDateTime_Values <> '###NULL###' AND [MaxDateTime] IN(SELECT [Item] FROM [dbo].CustomeSplit(@MaxDateTime_Values,',')))) AND (@MaxDateTime_Min IS NULL OR [MaxDateTime] >=  @MaxDateTime_Min) AND (@MaxDateTime_Max IS NULL OR [MaxDateTime] <=  @MaxDateTime_Max) AND (@Total_Values IS NULL OR  (@Total_Values = '###NULL###' AND [Total] IS NULL ) OR (@Total_Values <> '###NULL###' AND [Total] IN(SELECT [Item] FROM [dbo].CustomeSplit(@Total_Values,',')))) AND (@Total_Min IS NULL OR [Total] >=  @Total_Min) AND (@Total_Max IS NULL OR [Total] <=  @Total_Max) AND (@LastActivityNote IS NULL OR (@LastActivityNote = '###NULL###' AND LastActivityNote IS NULL ) OR (@LastActivityNote <> '###NULL###' AND [LastActivityNote] LIKE '%'+@LastActivityNote+'%')) AND (@LastActivityNote_Values IS NULL OR (@LastActivityNote_Values = '###NULL###' AND [LastActivityNote] IS NULL ) OR (@LastActivityNote_Values <> '###NULL###' AND [LastActivityNote] IN(SELECT [Item] FROM [dbo].CustomeSplit(@LastActivityNote_Values,',')))) AND (@LastActivityDateTime_Values IS NULL OR  (@LastActivityDateTime_Values = '###NULL###' AND [LastActivityDateTime] IS NULL ) OR (@LastActivityDateTime_Values <> '###NULL###' AND [LastActivityDateTime] IN(SELECT [Item] FROM [dbo].CustomeSplit(@LastActivityDateTime_Values,',')))) AND (@LastActivityDateTime_Min IS NULL OR [LastActivityDateTime] >=  @LastActivityDateTime_Min) AND (@LastActivityDateTime_Max IS NULL OR [LastActivityDateTime] <=  @LastActivityDateTime_Max) )ENDIF (@Sort_Ascending IS NULL OR @Sort_Column IS NULL) AND @Page_Size IS NULLBEGINSELECT BranchID,Active,CustName,RepId,SalesRep,OrderFrequency,DoNotContact,DoNotContactDate,DoNotContactBy,CustomerId,EnterDate,QuoteId,DeliveryDate,Interest,CustBranchCode,QuoteBranchCode,Note,MaxDateTime,Total,LastActivityNote,LastActivityDateTime FROM  [dbo].[VW_InActiveAccountFolloUpData] (NOLOCK) WHERE (@BranchID_Values IS NULL OR  (@BranchID_Values = '###NULL###' AND [BranchID] IS NULL ) OR (@BranchID_Values <> '###NULL###' AND [BranchID] IN(SELECT [Item] FROM [dbo].CustomeSplit(@BranchID_Values,',')))) AND (@BranchID_Min IS NULL OR [BranchID] >=  @BranchID_Min) AND (@BranchID_Max IS NULL OR [BranchID] <=  @BranchID_Max) AND (@Active IS NULL OR (@Active = '###NULL###' AND Active IS NULL ) OR (@Active <> '###NULL###' AND [Active] LIKE '%'+@Active+'%')) AND (@Active_Values IS NULL OR (@Active_Values = '###NULL###' AND [Active] IS NULL ) OR (@Active_Values <> '###NULL###' AND [Active] IN(SELECT [Item] FROM [dbo].CustomeSplit(@Active_Values,',')))) AND (@CustName IS NULL OR (@CustName = '###NULL###' AND CustName IS NULL ) OR (@CustName <> '###NULL###' AND [CustName] LIKE '%'+@CustName+'%')) AND (@CustName_Values IS NULL OR (@CustName_Values = '###NULL###' AND [CustName] IS NULL ) OR (@CustName_Values <> '###NULL###' AND [CustName] IN(SELECT [Item] FROM [dbo].CustomeSplit(@CustName_Values,',')))) AND (@RepId_Values IS NULL OR  (@RepId_Values = '###NULL###' AND [RepId] IS NULL ) OR (@RepId_Values <> '###NULL###' AND [RepId] IN(SELECT [Item] FROM [dbo].CustomeSplit(@RepId_Values,',')))) AND (@RepId_Min IS NULL OR [RepId] >=  @RepId_Min) AND (@RepId_Max IS NULL OR [RepId] <=  @RepId_Max) AND (@SalesRep IS NULL OR (@SalesRep = '###NULL###' AND SalesRep IS NULL ) OR (@SalesRep <> '###NULL###' AND [SalesRep] LIKE '%'+@SalesRep+'%')) AND (@SalesRep_Values IS NULL OR (@SalesRep_Values = '###NULL###' AND [SalesRep] IS NULL ) OR (@SalesRep_Values <> '###NULL###' AND [SalesRep] IN(SELECT [Item] FROM [dbo].CustomeSplit(@SalesRep_Values,',')))) AND (@OrderFrequency IS NULL OR (@OrderFrequency = '###NULL###' AND OrderFrequency IS NULL ) OR (@OrderFrequency <> '###NULL###' AND [OrderFrequency] LIKE '%'+@OrderFrequency+'%')) AND (@OrderFrequency_Values IS NULL OR (@OrderFrequency_Values = '###NULL###' AND [OrderFrequency] IS NULL ) OR (@OrderFrequency_Values <> '###NULL###' AND [OrderFrequency] IN(SELECT [Item] FROM [dbo].CustomeSplit(@OrderFrequency_Values,',')))) AND (@DoNotContact IS NULL OR [DoNotContact] =  @DoNotContact) AND (@DoNotContactDate_Values IS NULL OR  (@DoNotContactDate_Values = '###NULL###' AND [DoNotContactDate] IS NULL ) OR (@DoNotContactDate_Values <> '###NULL###' AND [DoNotContactDate] IN(SELECT [Item] FROM [dbo].CustomeSplit(@DoNotContactDate_Values,',')))) AND (@DoNotContactDate_Min IS NULL OR [DoNotContactDate] >=  @DoNotContactDate_Min) AND (@DoNotContactDate_Max IS NULL OR [DoNotContactDate] <=  @DoNotContactDate_Max) AND (@DoNotContactBy IS NULL OR (@DoNotContactBy = '###NULL###' AND DoNotContactBy IS NULL ) OR (@DoNotContactBy <> '###NULL###' AND [DoNotContactBy] LIKE '%'+@DoNotContactBy+'%')) AND (@DoNotContactBy_Values IS NULL OR (@DoNotContactBy_Values = '###NULL###' AND [DoNotContactBy] IS NULL ) OR (@DoNotContactBy_Values <> '###NULL###' AND [DoNotContactBy] IN(SELECT [Item] FROM [dbo].CustomeSplit(@DoNotContactBy_Values,',')))) AND (@CustomerId_Values IS NULL OR  (@CustomerId_Values = '###NULL###' AND [CustomerId] IS NULL ) OR (@CustomerId_Values <> '###NULL###' AND [CustomerId] IN(SELECT [Item] FROM [dbo].CustomeSplit(@CustomerId_Values,',')))) AND (@CustomerId_Min IS NULL OR [CustomerId] >=  @CustomerId_Min) AND (@CustomerId_Max IS NULL OR [CustomerId] <=  @CustomerId_Max) AND (@EnterDate_Values IS NULL OR  (@EnterDate_Values = '###NULL###' AND [EnterDate] IS NULL ) OR (@EnterDate_Values <> '###NULL###' AND [EnterDate] IN(SELECT [Item] FROM [dbo].CustomeSplit(@EnterDate_Values,',')))) AND (@EnterDate_Min IS NULL OR [EnterDate] >=  @EnterDate_Min) AND (@EnterDate_Max IS NULL OR [EnterDate] <=  @EnterDate_Max) AND (@QuoteId_Values IS NULL OR  (@QuoteId_Values = '###NULL###' AND [QuoteId] IS NULL ) OR (@QuoteId_Values <> '###NULL###' AND [QuoteId] IN(SELECT [Item] FROM [dbo].CustomeSplit(@QuoteId_Values,',')))) AND (@QuoteId_Min IS NULL OR [QuoteId] >=  @QuoteId_Min) AND (@QuoteId_Max IS NULL OR [QuoteId] <=  @QuoteId_Max) AND (@DeliveryDate_Values IS NULL OR  (@DeliveryDate_Values = '###NULL###' AND [DeliveryDate] IS NULL ) OR (@DeliveryDate_Values <> '###NULL###' AND [DeliveryDate] IN(SELECT [Item] FROM [dbo].CustomeSplit(@DeliveryDate_Values,',')))) AND (@DeliveryDate_Min IS NULL OR [DeliveryDate] >=  @DeliveryDate_Min) AND (@DeliveryDate_Max IS NULL OR [DeliveryDate] <=  @DeliveryDate_Max) AND (@Interest IS NULL OR (@Interest = '###NULL###' AND Interest IS NULL ) OR (@Interest <> '###NULL###' AND [Interest] LIKE '%'+@Interest+'%')) AND (@Interest_Values IS NULL OR (@Interest_Values = '###NULL###' AND [Interest] IS NULL ) OR (@Interest_Values <> '###NULL###' AND [Interest] IN(SELECT [Item] FROM [dbo].CustomeSplit(@Interest_Values,',')))) AND (@CustBranchCode IS NULL OR (@CustBranchCode = '###NULL###' AND CustBranchCode IS NULL ) OR (@CustBranchCode <> '###NULL###' AND [CustBranchCode] LIKE '%'+@CustBranchCode+'%')) AND (@CustBranchCode_Values IS NULL OR (@CustBranchCode_Values = '###NULL###' AND [CustBranchCode] IS NULL ) OR (@CustBranchCode_Values <> '###NULL###' AND [CustBranchCode] IN(SELECT [Item] FROM [dbo].CustomeSplit(@CustBranchCode_Values,',')))) AND (@QuoteBranchCode_Values IS NULL OR  (@QuoteBranchCode_Values = '###NULL###' AND [QuoteBranchCode] IS NULL ) OR (@QuoteBranchCode_Values <> '###NULL###' AND [QuoteBranchCode] IN(SELECT [Item] FROM [dbo].CustomeSplit(@QuoteBranchCode_Values,',')))) AND (@QuoteBranchCode_Min IS NULL OR [QuoteBranchCode] >=  @QuoteBranchCode_Min) AND (@QuoteBranchCode_Max IS NULL OR [QuoteBranchCode] <=  @QuoteBranchCode_Max) AND (@Note_Values IS NULL OR  (@Note_Values = '###NULL###' AND [Note] IS NULL ) OR (@Note_Values <> '###NULL###' AND [Note] IN(SELECT [Item] FROM [dbo].CustomeSplit(@Note_Values,',')))) AND (@Note_Min IS NULL OR [Note] >=  @Note_Min) AND (@Note_Max IS NULL OR [Note] <=  @Note_Max) AND (@MaxDateTime_Values IS NULL OR  (@MaxDateTime_Values = '###NULL###' AND [MaxDateTime] IS NULL ) OR (@MaxDateTime_Values <> '###NULL###' AND [MaxDateTime] IN(SELECT [Item] FROM [dbo].CustomeSplit(@MaxDateTime_Values,',')))) AND (@MaxDateTime_Min IS NULL OR [MaxDateTime] >=  @MaxDateTime_Min) AND (@MaxDateTime_Max IS NULL OR [MaxDateTime] <=  @MaxDateTime_Max) AND (@Total_Values IS NULL OR  (@Total_Values = '###NULL###' AND [Total] IS NULL ) OR (@Total_Values <> '###NULL###' AND [Total] IN(SELECT [Item] FROM [dbo].CustomeSplit(@Total_Values,',')))) AND (@Total_Min IS NULL OR [Total] >=  @Total_Min) AND (@Total_Max IS NULL OR [Total] <=  @Total_Max) AND (@LastActivityNote IS NULL OR (@LastActivityNote = '###NULL###' AND LastActivityNote IS NULL ) OR (@LastActivityNote <> '###NULL###' AND [LastActivityNote] LIKE '%'+@LastActivityNote+'%')) AND (@LastActivityNote_Values IS NULL OR (@LastActivityNote_Values = '###NULL###' AND [LastActivityNote] IS NULL ) OR (@LastActivityNote_Values <> '###NULL###' AND [LastActivityNote] IN(SELECT [Item] FROM [dbo].CustomeSplit(@LastActivityNote_Values,',')))) AND (@LastActivityDateTime_Values IS NULL OR  (@LastActivityDateTime_Values = '###NULL###' AND [LastActivityDateTime] IS NULL ) OR (@LastActivityDateTime_Values <> '###NULL###' AND [LastActivityDateTime] IN(SELECT [Item] FROM [dbo].CustomeSplit(@LastActivityDateTime_Values,',')))) AND (@LastActivityDateTime_Min IS NULL OR [LastActivityDateTime] >=  @LastActivityDateTime_Min) AND (@LastActivityDateTime_Max IS NULL OR [LastActivityDateTime] <=  @LastActivityDateTime_Max) ENDELSEBEGINSELECT BranchID,Active,CustName,RepId,SalesRep,OrderFrequency,DoNotContact,DoNotContactDate,DoNotContactBy,CustomerId,EnterDate,QuoteId,DeliveryDate,Interest,CustBranchCode,QuoteBranchCode,Note,MaxDateTime,Total,LastActivityNote,LastActivityDateTime FROM  (SELECT ROW_NUMBER() OVER  ( ORDER BY CASE WHEN (@Sort_Column='VW_InActiveAccountFolloUpData.BranchID' OR @Sort_Column='BranchID') AND @Sort_Ascending=1 THEN (CASE WHEN [VW_InActiveAccountFolloUpData].[BranchID] IS NULL THEN 1 ELSE 0 END) ELSE NULL END,CASE WHEN (@Sort_Column='VW_InActiveAccountFolloUpData.BranchID' OR @Sort_Column='BranchID') AND @Sort_Ascending=1 THEN [VW_InActiveAccountFolloUpData].[BranchID] ELSE NULL END,CASE WHEN (@Sort_Column='VW_InActiveAccountFolloUpData.BranchID' OR @Sort_Column='BranchID') AND @Sort_Ascending=0 THEN [VW_InActiveAccountFolloUpData].[BranchID] ELSE NULL END DESC,CASE WHEN (@Sort_Column='VW_InActiveAccountFolloUpData.Active' OR @Sort_Column='Active') AND @Sort_Ascending=1 THEN (CASE WHEN [VW_InActiveAccountFolloUpData].[Active] IS NULL THEN 1 ELSE 0 END) ELSE NULL END,CASE WHEN (@Sort_Column='VW_InActiveAccountFolloUpData.Active' OR @Sort_Column='Active') AND @Sort_Ascending=1 THEN [VW_InActiveAccountFolloUpData].[Active] ELSE NULL END,CASE WHEN (@Sort_Column='VW_InActiveAccountFolloUpData.Active' OR @Sort_Column='Active') AND @Sort_Ascending=0 THEN [VW_InActiveAccountFolloUpData].[Active] ELSE NULL END DESC,CASE WHEN (@Sort_Column='VW_InActiveAccountFolloUpData.CustName' OR @Sort_Column='CustName') AND @Sort_Ascending=1 THEN (CASE WHEN [VW_InActiveAccountFolloUpData].[CustName] IS NULL THEN 1 ELSE 0 END) ELSE NULL END,CASE WHEN (@Sort_Column='VW_InActiveAccountFolloUpData.CustName' OR @Sort_Column='CustName') AND @Sort_Ascending=1 THEN [VW_InActiveAccountFolloUpData].[CustName] ELSE NULL END,CASE WHEN (@Sort_Column='VW_InActiveAccountFolloUpData.CustName' OR @Sort_Column='CustName') AND @Sort_Ascending=0 THEN [VW_InActiveAccountFolloUpData].[CustName] ELSE NULL END DESC,CASE WHEN (@Sort_Column='VW_InActiveAccountFolloUpData.RepId' OR @Sort_Column='RepId') AND @Sort_Ascending=1 THEN (CASE WHEN [VW_InActiveAccountFolloUpData].[RepId] IS NULL THEN 1 ELSE 0 END) ELSE NULL END,CASE WHEN (@Sort_Column='VW_InActiveAccountFolloUpData.RepId' OR @Sort_Column='RepId') AND @Sort_Ascending=1 THEN [VW_InActiveAccountFolloUpData].[RepId] ELSE NULL END,CASE WHEN (@Sort_Column='VW_InActiveAccountFolloUpData.RepId' OR @Sort_Column='RepId') AND @Sort_Ascending=0 THEN [VW_InActiveAccountFolloUpData].[RepId] ELSE NULL END DESC,CASE WHEN (@Sort_Column='VW_InActiveAccountFolloUpData.SalesRep' OR @Sort_Column='SalesRep') AND @Sort_Ascending=1 THEN (CASE WHEN [VW_InActiveAccountFolloUpData].[SalesRep] IS NULL THEN 1 ELSE 0 END) ELSE NULL END,CASE WHEN (@Sort_Column='VW_InActiveAccountFolloUpData.SalesRep' OR @Sort_Column='SalesRep') AND @Sort_Ascending=1 THEN [VW_InActiveAccountFolloUpData].[SalesRep] ELSE NULL END,CASE WHEN (@Sort_Column='VW_InActiveAccountFolloUpData.SalesRep' OR @Sort_Column='SalesRep') AND @Sort_Ascending=0 THEN [VW_InActiveAccountFolloUpData].[SalesRep] ELSE NULL END DESC,CASE WHEN (@Sort_Column='VW_InActiveAccountFolloUpData.OrderFrequency' OR @Sort_Column='OrderFrequency') AND @Sort_Ascending=1 THEN (CASE WHEN [VW_InActiveAccountFolloUpData].[OrderFrequency] IS NULL THEN 1 ELSE 0 END) ELSE NULL END,CASE WHEN (@Sort_Column='VW_InActiveAccountFolloUpData.OrderFrequency' OR @Sort_Column='OrderFrequency') AND @Sort_Ascending=1 THEN [VW_InActiveAccountFolloUpData].[OrderFrequency] ELSE NULL END,CASE WHEN (@Sort_Column='VW_InActiveAccountFolloUpData.OrderFrequency' OR @Sort_Column='OrderFrequency') AND @Sort_Ascending=0 THEN [VW_InActiveAccountFolloUpData].[OrderFrequency] ELSE NULL END DESC,CASE WHEN (@Sort_Column='VW_InActiveAccountFolloUpData.DoNotContact' OR @Sort_Column='DoNotContact') AND @Sort_Ascending=1 THEN (CASE WHEN [VW_InActiveAccountFolloUpData].[DoNotContact] IS NULL THEN 1 ELSE 0 END) ELSE NULL END,CASE WHEN (@Sort_Column='VW_InActiveAccountFolloUpData.DoNotContact' OR @Sort_Column='DoNotContact') AND @Sort_Ascending=1 THEN [VW_InActiveAccountFolloUpData].[DoNotContact] ELSE NULL END,CASE WHEN (@Sort_Column='VW_InActiveAccountFolloUpData.DoNotContact' OR @Sort_Column='DoNotContact') AND @Sort_Ascending=0 THEN [VW_InActiveAccountFolloUpData].[DoNotContact] ELSE NULL END DESC,CASE WHEN (@Sort_Column='VW_InActiveAccountFolloUpData.DoNotContactDate' OR @Sort_Column='DoNotContactDate') AND @Sort_Ascending=1 THEN (CASE WHEN [VW_InActiveAccountFolloUpData].[DoNotContactDate] IS NULL THEN 1 ELSE 0 END) ELSE NULL END,CASE WHEN (@Sort_Column='VW_InActiveAccountFolloUpData.DoNotContactDate' OR @Sort_Column='DoNotContactDate') AND @Sort_Ascending=1 THEN [VW_InActiveAccountFolloUpData].[DoNotContactDate] ELSE NULL END,CASE WHEN (@Sort_Column='VW_InActiveAccountFolloUpData.DoNotContactDate' OR @Sort_Column='DoNotContactDate') AND @Sort_Ascending=0 THEN [VW_InActiveAccountFolloUpData].[DoNotContactDate] ELSE NULL END DESC,CASE WHEN (@Sort_Column='VW_InActiveAccountFolloUpData.DoNotContactBy' OR @Sort_Column='DoNotContactBy') AND @Sort_Ascending=1 THEN (CASE WHEN [VW_InActiveAccountFolloUpData].[DoNotContactBy] IS NULL THEN 1 ELSE 0 END) ELSE NULL END,CASE WHEN (@Sort_Column='VW_InActiveAccountFolloUpData.DoNotContactBy' OR @Sort_Column='DoNotContactBy') AND @Sort_Ascending=1 THEN [VW_InActiveAccountFolloUpData].[DoNotContactBy] ELSE NULL END,CASE WHEN (@Sort_Column='VW_InActiveAccountFolloUpData.DoNotContactBy' OR @Sort_Column='DoNotContactBy') AND @Sort_Ascending=0 THEN [VW_InActiveAccountFolloUpData].[DoNotContactBy] ELSE NULL END DESC,CASE WHEN (@Sort_Column='VW_InActiveAccountFolloUpData.CustomerId' OR @Sort_Column='CustomerId') AND @Sort_Ascending=1 THEN (CASE WHEN [VW_InActiveAccountFolloUpData].[CustomerId] IS NULL THEN 1 ELSE 0 END) ELSE NULL END,CASE WHEN (@Sort_Column='VW_InActiveAccountFolloUpData.CustomerId' OR @Sort_Column='CustomerId') AND @Sort_Ascending=1 THEN [VW_InActiveAccountFolloUpData].[CustomerId] ELSE NULL END,CASE WHEN (@Sort_Column='VW_InActiveAccountFolloUpData.CustomerId' OR @Sort_Column='CustomerId') AND @Sort_Ascending=0 THEN [VW_InActiveAccountFolloUpData].[CustomerId] ELSE NULL END DESC,CASE WHEN (@Sort_Column='VW_InActiveAccountFolloUpData.EnterDate' OR @Sort_Column='EnterDate') AND @Sort_Ascending=1 THEN (CASE WHEN [VW_InActiveAccountFolloUpData].[EnterDate] IS NULL THEN 1 ELSE 0 END) ELSE NULL END,CASE WHEN (@Sort_Column='VW_InActiveAccountFolloUpData.EnterDate' OR @Sort_Column='EnterDate') AND @Sort_Ascending=1 THEN [VW_InActiveAccountFolloUpData].[EnterDate] ELSE NULL END,CASE WHEN (@Sort_Column='VW_InActiveAccountFolloUpData.EnterDate' OR @Sort_Column='EnterDate') AND @Sort_Ascending=0 THEN [VW_InActiveAccountFolloUpData].[EnterDate] ELSE NULL END DESC,CASE WHEN (@Sort_Column='VW_InActiveAccountFolloUpData.QuoteId' OR @Sort_Column='QuoteId') AND @Sort_Ascending=1 THEN (CASE WHEN [VW_InActiveAccountFolloUpData].[QuoteId] IS NULL THEN 1 ELSE 0 END) ELSE NULL END,CASE WHEN (@Sort_Column='VW_InActiveAccountFolloUpData.QuoteId' OR @Sort_Column='QuoteId') AND @Sort_Ascending=1 THEN [VW_InActiveAccountFolloUpData].[QuoteId] ELSE NULL END,CASE WHEN (@Sort_Column='VW_InActiveAccountFolloUpData.QuoteId' OR @Sort_Column='QuoteId') AND @Sort_Ascending=0 THEN [VW_InActiveAccountFolloUpData].[QuoteId] ELSE NULL END DESC,CASE WHEN (@Sort_Column='VW_InActiveAccountFolloUpData.DeliveryDate' OR @Sort_Column='DeliveryDate') AND @Sort_Ascending=1 THEN (CASE WHEN [VW_InActiveAccountFolloUpData].[DeliveryDate] IS NULL THEN 1 ELSE 0 END) ELSE NULL END,CASE WHEN (@Sort_Column='VW_InActiveAccountFolloUpData.DeliveryDate' OR @Sort_Column='DeliveryDate') AND @Sort_Ascending=1 THEN [VW_InActiveAccountFolloUpData].[DeliveryDate] ELSE NULL END,CASE WHEN (@Sort_Column='VW_InActiveAccountFolloUpData.DeliveryDate' OR @Sort_Column='DeliveryDate') AND @Sort_Ascending=0 THEN [VW_InActiveAccountFolloUpData].[DeliveryDate] ELSE NULL END DESC,CASE WHEN (@Sort_Column='VW_InActiveAccountFolloUpData.Interest' OR @Sort_Column='Interest') AND @Sort_Ascending=1 THEN (CASE WHEN [VW_InActiveAccountFolloUpData].[Interest] IS NULL THEN 1 ELSE 0 END) ELSE NULL END,CASE WHEN (@Sort_Column='VW_InActiveAccountFolloUpData.Interest' OR @Sort_Column='Interest') AND @Sort_Ascending=1 THEN [VW_InActiveAccountFolloUpData].[Interest] ELSE NULL END,CASE WHEN (@Sort_Column='VW_InActiveAccountFolloUpData.Interest' OR @Sort_Column='Interest') AND @Sort_Ascending=0 THEN [VW_InActiveAccountFolloUpData].[Interest] ELSE NULL END DESC,CASE WHEN (@Sort_Column='VW_InActiveAccountFolloUpData.CustBranchCode' OR @Sort_Column='CustBranchCode') AND @Sort_Ascending=1 THEN (CASE WHEN [VW_InActiveAccountFolloUpData].[CustBranchCode] IS NULL THEN 1 ELSE 0 END) ELSE NULL END,CASE WHEN (@Sort_Column='VW_InActiveAccountFolloUpData.CustBranchCode' OR @Sort_Column='CustBranchCode') AND @Sort_Ascending=1 THEN [VW_InActiveAccountFolloUpData].[CustBranchCode] ELSE NULL END,CASE WHEN (@Sort_Column='VW_InActiveAccountFolloUpData.CustBranchCode' OR @Sort_Column='CustBranchCode') AND @Sort_Ascending=0 THEN [VW_InActiveAccountFolloUpData].[CustBranchCode] ELSE NULL END DESC,CASE WHEN (@Sort_Column='VW_InActiveAccountFolloUpData.QuoteBranchCode' OR @Sort_Column='QuoteBranchCode') AND @Sort_Ascending=1 THEN (CASE WHEN [VW_InActiveAccountFolloUpData].[QuoteBranchCode] IS NULL THEN 1 ELSE 0 END) ELSE NULL END,CASE WHEN (@Sort_Column='VW_InActiveAccountFolloUpData.QuoteBranchCode' OR @Sort_Column='QuoteBranchCode') AND @Sort_Ascending=1 THEN [VW_InActiveAccountFolloUpData].[QuoteBranchCode] ELSE NULL END,CASE WHEN (@Sort_Column='VW_InActiveAccountFolloUpData.QuoteBranchCode' OR @Sort_Column='QuoteBranchCode') AND @Sort_Ascending=0 THEN [VW_InActiveAccountFolloUpData].[QuoteBranchCode] ELSE NULL END DESC,CASE WHEN (@Sort_Column='VW_InActiveAccountFolloUpData.Note' OR @Sort_Column='Note') AND @Sort_Ascending=1 THEN (CASE WHEN [VW_InActiveAccountFolloUpData].[Note] IS NULL THEN 1 ELSE 0 END) ELSE NULL END,CASE WHEN (@Sort_Column='VW_InActiveAccountFolloUpData.Note' OR @Sort_Column='Note') AND @Sort_Ascending=1 THEN [VW_InActiveAccountFolloUpData].[Note] ELSE NULL END,CASE WHEN (@Sort_Column='VW_InActiveAccountFolloUpData.Note' OR @Sort_Column='Note') AND @Sort_Ascending=0 THEN [VW_InActiveAccountFolloUpData].[Note] ELSE NULL END DESC,CASE WHEN (@Sort_Column='VW_InActiveAccountFolloUpData.MaxDateTime' OR @Sort_Column='MaxDateTime') AND @Sort_Ascending=1 THEN (CASE WHEN [VW_InActiveAccountFolloUpData].[MaxDateTime] IS NULL THEN 1 ELSE 0 END) ELSE NULL END,CASE WHEN (@Sort_Column='VW_InActiveAccountFolloUpData.MaxDateTime' OR @Sort_Column='MaxDateTime') AND @Sort_Ascending=1 THEN [VW_InActiveAccountFolloUpData].[MaxDateTime] ELSE NULL END,CASE WHEN (@Sort_Column='VW_InActiveAccountFolloUpData.MaxDateTime' OR @Sort_Column='MaxDateTime') AND @Sort_Ascending=0 THEN [VW_InActiveAccountFolloUpData].[MaxDateTime] ELSE NULL END DESC,CASE WHEN (@Sort_Column='VW_InActiveAccountFolloUpData.Total' OR @Sort_Column='Total') AND @Sort_Ascending=1 THEN (CASE WHEN [VW_InActiveAccountFolloUpData].[Total] IS NULL THEN 1 ELSE 0 END) ELSE NULL END,CASE WHEN (@Sort_Column='VW_InActiveAccountFolloUpData.Total' OR @Sort_Column='Total') AND @Sort_Ascending=1 THEN [VW_InActiveAccountFolloUpData].[Total] ELSE NULL END,CASE WHEN (@Sort_Column='VW_InActiveAccountFolloUpData.Total' OR @Sort_Column='Total') AND @Sort_Ascending=0 THEN [VW_InActiveAccountFolloUpData].[Total] ELSE NULL END DESC,CASE WHEN (@Sort_Column='VW_InActiveAccountFolloUpData.LastActivityNote' OR @Sort_Column='LastActivityNote') AND @Sort_Ascending=1 THEN (CASE WHEN [VW_InActiveAccountFolloUpData].[LastActivityNote] IS NULL THEN 1 ELSE 0 END) ELSE NULL END,CASE WHEN (@Sort_Column='VW_InActiveAccountFolloUpData.LastActivityNote' OR @Sort_Column='LastActivityNote') AND @Sort_Ascending=1 THEN [VW_InActiveAccountFolloUpData].[LastActivityNote] ELSE NULL END,CASE WHEN (@Sort_Column='VW_InActiveAccountFolloUpData.LastActivityNote' OR @Sort_Column='LastActivityNote') AND @Sort_Ascending=0 THEN [VW_InActiveAccountFolloUpData].[LastActivityNote] ELSE NULL END DESC,CASE WHEN (@Sort_Column='VW_InActiveAccountFolloUpData.LastActivityDateTime' OR @Sort_Column='LastActivityDateTime') AND @Sort_Ascending=1 THEN (CASE WHEN [VW_InActiveAccountFolloUpData].[LastActivityDateTime] IS NULL THEN 1 ELSE 0 END) ELSE NULL END,CASE WHEN (@Sort_Column='VW_InActiveAccountFolloUpData.LastActivityDateTime' OR @Sort_Column='LastActivityDateTime') AND @Sort_Ascending=1 THEN [VW_InActiveAccountFolloUpData].[LastActivityDateTime] ELSE NULL END,CASE WHEN (@Sort_Column='VW_InActiveAccountFolloUpData.LastActivityDateTime' OR @Sort_Column='LastActivityDateTime') AND @Sort_Ascending=0 THEN [VW_InActiveAccountFolloUpData].[LastActivityDateTime] ELSE NULL END DESC ) AS RowNum, [VW_InActiveAccountFolloUpData].* FROM  [dbo].[VW_InActiveAccountFolloUpData] (NOLOCK) WHERE (@BranchID_Values IS NULL OR  (@BranchID_Values = '###NULL###' AND [BranchID] IS NULL ) OR (@BranchID_Values <> '###NULL###' AND [BranchID] IN(SELECT [Item] FROM [dbo].CustomeSplit(@BranchID_Values,',')))) AND (@BranchID_Min IS NULL OR [BranchID] >=  @BranchID_Min) AND (@BranchID_Max IS NULL OR [BranchID] <=  @BranchID_Max) AND (@Active IS NULL OR (@Active = '###NULL###' AND Active IS NULL ) OR (@Active <> '###NULL###' AND [Active] LIKE '%'+@Active+'%')) AND (@Active_Values IS NULL OR (@Active_Values = '###NULL###' AND [Active] IS NULL ) OR (@Active_Values <> '###NULL###' AND [Active] IN(SELECT [Item] FROM [dbo].CustomeSplit(@Active_Values,',')))) AND (@CustName IS NULL OR (@CustName = '###NULL###' AND CustName IS NULL ) OR (@CustName <> '###NULL###' AND [CustName] LIKE '%'+@CustName+'%')) AND (@CustName_Values IS NULL OR (@CustName_Values = '###NULL###' AND [CustName] IS NULL ) OR (@CustName_Values <> '###NULL###' AND [CustName] IN(SELECT [Item] FROM [dbo].CustomeSplit(@CustName_Values,',')))) AND (@RepId_Values IS NULL OR  (@RepId_Values = '###NULL###' AND [RepId] IS NULL ) OR (@RepId_Values <> '###NULL###' AND [RepId] IN(SELECT [Item] FROM [dbo].CustomeSplit(@RepId_Values,',')))) AND (@RepId_Min IS NULL OR [RepId] >=  @RepId_Min) AND (@RepId_Max IS NULL OR [RepId] <=  @RepId_Max) AND (@SalesRep IS NULL OR (@SalesRep = '###NULL###' AND SalesRep IS NULL ) OR (@SalesRep <> '###NULL###' AND [SalesRep] LIKE '%'+@SalesRep+'%')) AND (@SalesRep_Values IS NULL OR (@SalesRep_Values = '###NULL###' AND [SalesRep] IS NULL ) OR (@SalesRep_Values <> '###NULL###' AND [SalesRep] IN(SELECT [Item] FROM [dbo].CustomeSplit(@SalesRep_Values,',')))) AND (@OrderFrequency IS NULL OR (@OrderFrequency = '###NULL###' AND OrderFrequency IS NULL ) OR (@OrderFrequency <> '###NULL###' AND [OrderFrequency] LIKE '%'+@OrderFrequency+'%')) AND (@OrderFrequency_Values IS NULL OR (@OrderFrequency_Values = '###NULL###' AND [OrderFrequency] IS NULL ) OR (@OrderFrequency_Values <> '###NULL###' AND [OrderFrequency] IN(SELECT [Item] FROM [dbo].CustomeSplit(@OrderFrequency_Values,',')))) AND (@DoNotContact IS NULL OR [DoNotContact] =  @DoNotContact) AND (@DoNotContactDate_Values IS NULL OR  (@DoNotContactDate_Values = '###NULL###' AND [DoNotContactDate] IS NULL ) OR (@DoNotContactDate_Values <> '###NULL###' AND [DoNotContactDate] IN(SELECT [Item] FROM [dbo].CustomeSplit(@DoNotContactDate_Values,',')))) AND (@DoNotContactDate_Min IS NULL OR [DoNotContactDate] >=  @DoNotContactDate_Min) AND (@DoNotContactDate_Max IS NULL OR [DoNotContactDate] <=  @DoNotContactDate_Max) AND (@DoNotContactBy IS NULL OR (@DoNotContactBy = '###NULL###' AND DoNotContactBy IS NULL ) OR (@DoNotContactBy <> '###NULL###' AND [DoNotContactBy] LIKE '%'+@DoNotContactBy+'%')) AND (@DoNotContactBy_Values IS NULL OR (@DoNotContactBy_Values = '###NULL###' AND [DoNotContactBy] IS NULL ) OR (@DoNotContactBy_Values <> '###NULL###' AND [DoNotContactBy] IN(SELECT [Item] FROM [dbo].CustomeSplit(@DoNotContactBy_Values,',')))) AND (@CustomerId_Values IS NULL OR  (@CustomerId_Values = '###NULL###' AND [CustomerId] IS NULL ) OR (@CustomerId_Values <> '###NULL###' AND [CustomerId] IN(SELECT [Item] FROM [dbo].CustomeSplit(@CustomerId_Values,',')))) AND (@CustomerId_Min IS NULL OR [CustomerId] >=  @CustomerId_Min) AND (@CustomerId_Max IS NULL OR [CustomerId] <=  @CustomerId_Max) AND (@EnterDate_Values IS NULL OR  (@EnterDate_Values = '###NULL###' AND [EnterDate] IS NULL ) OR (@EnterDate_Values <> '###NULL###' AND [EnterDate] IN(SELECT [Item] FROM [dbo].CustomeSplit(@EnterDate_Values,',')))) AND (@EnterDate_Min IS NULL OR [EnterDate] >=  @EnterDate_Min) AND (@EnterDate_Max IS NULL OR [EnterDate] <=  @EnterDate_Max) AND (@QuoteId_Values IS NULL OR  (@QuoteId_Values = '###NULL###' AND [QuoteId] IS NULL ) OR (@QuoteId_Values <> '###NULL###' AND [QuoteId] IN(SELECT [Item] FROM [dbo].CustomeSplit(@QuoteId_Values,',')))) AND (@QuoteId_Min IS NULL OR [QuoteId] >=  @QuoteId_Min) AND (@QuoteId_Max IS NULL OR [QuoteId] <=  @QuoteId_Max) AND (@DeliveryDate_Values IS NULL OR  (@DeliveryDate_Values = '###NULL###' AND [DeliveryDate] IS NULL ) OR (@DeliveryDate_Values <> '###NULL###' AND [DeliveryDate] IN(SELECT [Item] FROM [dbo].CustomeSplit(@DeliveryDate_Values,',')))) AND (@DeliveryDate_Min IS NULL OR [DeliveryDate] >=  @DeliveryDate_Min) AND (@DeliveryDate_Max IS NULL OR [DeliveryDate] <=  @DeliveryDate_Max) AND (@Interest IS NULL OR (@Interest = '###NULL###' AND Interest IS NULL ) OR (@Interest <> '###NULL###' AND [Interest] LIKE '%'+@Interest+'%')) AND (@Interest_Values IS NULL OR (@Interest_Values = '###NULL###' AND [Interest] IS NULL ) OR (@Interest_Values <> '###NULL###' AND [Interest] IN(SELECT [Item] FROM [dbo].CustomeSplit(@Interest_Values,',')))) AND (@CustBranchCode IS NULL OR (@CustBranchCode = '###NULL###' AND CustBranchCode IS NULL ) OR (@CustBranchCode <> '###NULL###' AND [CustBranchCode] LIKE '%'+@CustBranchCode+'%')) AND (@CustBranchCode_Values IS NULL OR (@CustBranchCode_Values = '###NULL###' AND [CustBranchCode] IS NULL ) OR (@CustBranchCode_Values <> '###NULL###' AND [CustBranchCode] IN(SELECT [Item] FROM [dbo].CustomeSplit(@CustBranchCode_Values,',')))) AND (@QuoteBranchCode_Values IS NULL OR  (@QuoteBranchCode_Values = '###NULL###' AND [QuoteBranchCode] IS NULL ) OR (@QuoteBranchCode_Values <> '###NULL###' AND [QuoteBranchCode] IN(SELECT [Item] FROM [dbo].CustomeSplit(@QuoteBranchCode_Values,',')))) AND (@QuoteBranchCode_Min IS NULL OR [QuoteBranchCode] >=  @QuoteBranchCode_Min) AND (@QuoteBranchCode_Max IS NULL OR [QuoteBranchCode] <=  @QuoteBranchCode_Max) AND (@Note_Values IS NULL OR  (@Note_Values = '###NULL###' AND [Note] IS NULL ) OR (@Note_Values <> '###NULL###' AND [Note] IN(SELECT [Item] FROM [dbo].CustomeSplit(@Note_Values,',')))) AND (@Note_Min IS NULL OR [Note] >=  @Note_Min) AND (@Note_Max IS NULL OR [Note] <=  @Note_Max) AND (@MaxDateTime_Values IS NULL OR  (@MaxDateTime_Values = '###NULL###' AND [MaxDateTime] IS NULL ) OR (@MaxDateTime_Values <> '###NULL###' AND [MaxDateTime] IN(SELECT [Item] FROM [dbo].CustomeSplit(@MaxDateTime_Values,',')))) AND (@MaxDateTime_Min IS NULL OR [MaxDateTime] >=  @MaxDateTime_Min) AND (@MaxDateTime_Max IS NULL OR [MaxDateTime] <=  @MaxDateTime_Max) AND (@Total_Values IS NULL OR  (@Total_Values = '###NULL###' AND [Total] IS NULL ) OR (@Total_Values <> '###NULL###' AND [Total] IN(SELECT [Item] FROM [dbo].CustomeSplit(@Total_Values,',')))) AND (@Total_Min IS NULL OR [Total] >=  @Total_Min) AND (@Total_Max IS NULL OR [Total] <=  @Total_Max) AND (@LastActivityNote IS NULL OR (@LastActivityNote = '###NULL###' AND LastActivityNote IS NULL ) OR (@LastActivityNote <> '###NULL###' AND [LastActivityNote] LIKE '%'+@LastActivityNote+'%')) AND (@LastActivityNote_Values IS NULL OR (@LastActivityNote_Values = '###NULL###' AND [LastActivityNote] IS NULL ) OR (@LastActivityNote_Values <> '###NULL###' AND [LastActivityNote] IN(SELECT [Item] FROM [dbo].CustomeSplit(@LastActivityNote_Values,',')))) AND (@LastActivityDateTime_Values IS NULL OR  (@LastActivityDateTime_Values = '###NULL###' AND [LastActivityDateTime] IS NULL ) OR (@LastActivityDateTime_Values <> '###NULL###' AND [LastActivityDateTime] IN(SELECT [Item] FROM [dbo].CustomeSplit(@LastActivityDateTime_Values,',')))) AND (@LastActivityDateTime_Min IS NULL OR [LastActivityDateTime] >=  @LastActivityDateTime_Min) AND (@LastActivityDateTime_Max IS NULL OR [LastActivityDateTime] <=  @LastActivityDateTime_Max) ) AS RowConstrainedResultWHERE (@Page_Size IS NULL) OR (RowNum >= @Page_Size*(ISNULL(@Page_Index,1)-1)+1 AND RowNum <= @Page_Size*ISNULL(@Page_Index,1))ORDER BY RowNumENDSET NOCOUNT OFF;END
GO


/****** Object:  View [dbo].[VW_InActiveAccountFolloUpData]    Script Date: 11-08-2020 22:57:10 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO





ALTER   VIEW [dbo].[VW_InActiveAccountFolloUpData]
AS
SELECT 
	 [Branch].[BranchID]
	,[Branch].[Active]
	,[Customers].[CustName]
	,[Employee].[EmployeeID] [RepId]
	,[Employee].[EmployeeName] [SalesRep]
	,[Customers].[OrderFrequency]
	,[Customers].[DoNotContact]
	,[Customers].[DoNotContactDate]
	,[Customers].[DoNotContactBy]
	,[Customers].[CustID] [CustomerId]
	,MAX(ISNULL([Quote].[QuoteEnteredDate], CONVERT(DATETIME, '1990-01-01 00:00:00', 102))) [EnterDate]
	,MAX([Quote].[QuoteID]) [QuoteId]
	,MAX([Quote].[DeliveryDate]) [DeliveryDate]
	,[QuoteTypes].[QuoteType] [Interest]
	,[Branch].[BranchCode] [CustBranchCode]
	,NULL [QuoteBranchCode]
	,NULL [Note]
	,[SalesActivity].[MaxDateTime]
	,([Quote].[QuoteFreight] + [Quote].[QuoteDelivery] + [Quote].[QuoteLabor] + [Quote].[QuoteEquipRented]) [Total]
	,[LastActivity].[LastActivityNote]
	,[LastActivity].[LastActivityDateTime]
FROM [dbo].[tblBranch] [Branch] (NOLOCK)
INNER JOIN [dbo].[tblCustomers] [Customers] (NOLOCK)
	ON [Customers].[CustBranchID] = [Branch].[BranchID]
INNER JOIN [dbo].[tblEmployee] [Employee] (NOLOCK)
	ON [Employee].[EmployeeID] = [Customers].[CustAccountRep]
LEFT JOIN [dbo].[tblQuoteTypes] [QuoteTypes] (NOLOCK)
INNER JOIN [dbo].[tblQuote] [Quote] (NOLOCK)
	ON [Quote].[InterestType] = [QuoteTypes].[QuoteTypeNo]
	ON [Quote].[CustID] = [Customers].[CustID]
INNER JOIN(
	SELECT MAX(DateTime) [MaxDateTime],[CustomerId]
	FROM [dbo].[tblSalesActivity] (NOLOCK)
	GROUP BY [CustomerId]
)[SalesActivity]
ON [SalesActivity].[CustomerId] = [Customers].[CustID]
LEFT JOIN(
	SELECT
         [SalesActivity].[DateTime] [LastActivityDateTime]
		 ,LEFT([SalesActivity].[Note], 150) [LastActivityNote]
		 ,[SalesActivityDepartment].[DepartmentDescription] 
		 ,[SalesActivity].[DepartmentID]
		 ,[SalesActivity].[QuoteId]
      FROM [dbo].[tblSalesActivity] [SalesActivity] (NOLOCK)
	  INNER JOIN [dbo].[tblSalesActivityDepartment] [SalesActivityDepartment] (NOLOCK)
	  	   ON [SalesActivityDepartment].[DepartmentId] = [SalesActivity].[DepartmentID]  
		   AND [SalesActivityDepartment].[DepartmentDescription] = 'Sales'
) AS [LastActivity]
ON [LastActivity].[QuoteId] = [Quote].[QuoteID]
GROUP BY 
	 [Branch].[BranchID]
	,[Branch].[Active]
	,[Customers].[CustName]
	,[Employee].[EmployeeID] 
	,[Employee].[EmployeeName]
	,[Customers].[OrderFrequency]
	,[Customers].[DoNotContact]
	,[Customers].[DoNotContactDate]
	,[Customers].[DoNotContactBy]
	,[Customers].[CustID]
	,ISNULL([Quote].[QuoteEnteredDate], CONVERT(DATETIME, '1990-01-01 00:00:00', 102))
	,[Quote].[QuoteID]
	,[Quote].[DeliveryDate]
	,[QuoteTypes].[QuoteType]
	,[Branch].[BranchCode]
	,[SalesActivity].[MaxDateTime]
	,[SalesActivity].[MaxDateTime]
	,([Quote].[QuoteFreight] + [Quote].[QuoteDelivery] + [Quote].[QuoteLabor] + [Quote].[QuoteEquipRented])
	,[LastActivity].[LastActivityNote]
	,[LastActivity].[LastActivityDateTime]
GO



